# Proposal: Enhanced Template Viewer UI

## Background

用户需要一个增强的界面，能够：
1. 查看已加载的模板内容
2. 可视化显示模板中需要填充的位置
3. 查看将要填充的内容
4. 预览填充后的完整文档

## Problem

当前 Web UI 只能上传模板和输入内容，但无法：
- 预览模板的实际内容和结构
- 直观看到占位符在文档中的位置
- 对比填充前后的效果

## Goals

1. **模板预览**：加载后显示模板内容，高亮占位符位置
2. **占位符面板**：列出所有占位符及其配置
3. **内容面板**：显示 LLM 生成的待填充内容
4. **填充预览**：显示填充后的文档效果（对比视图）

---

## 界面设计

### 布局方案

```
┌─────────────────────────────────────────────────────────────┐
│                      Template Filler                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 模板预览    │  │ 占位符列表   │  │ 填充内容预览        │  │
│  │             │  │             │  │                     │  │
│  │ [模板内容]  │  │ {{TITLE}}   │  │ TITLE: 人工智能...  │  │
│  │ 高亮占位符  │  │ {{SUMMARY}} │  │ SUMMARY: 本项目...  │  │
│  │             │  │ ...         │  │ ...                 │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│          [👁️ 预览填充效果]  [📥 下载文档]                    │
│  (点击按钮后弹出模态框显示填充后的文档预览)                    │
└─────────────────────────────────────────────────────────────┘
```

### 核心功能

| 区域 | 功能 |
|------|------|
| 模板预览 | 显示模板内容（HTML 渲染），高亮 `{{占位符}}` |
| 占位符列表 | 列出所有检测到的占位符，可配置 prompt/mode |
| 填充内容 | 显示每个占位符的生成内容，select 模式可选择 |
| 预览按钮 | 点击后弹出模态框显示填充后的文档效果 |

---

## Proposed Solution

### 技术方案

1. **模板内容提取**：将 DOCX 转换为 HTML 以在浏览器中显示
   - 使用 `mammoth` (Python) 将 DOCX 转 HTML
   - 保留基本格式（加粗、斜体、列表等）

2. **占位符高亮**：用特殊样式标记 `{{KEYWORD}}`

3. **实时预览**：生成内容后，实时替换 HTML 中的占位符

### 新增 API

| 端点 | 功能 |
|------|------|
| `POST /api/parse-template` | 解析模板，返回 HTML 和占位符列表 |
| `GET /api/template-html/{id}` | 获取模板的 HTML 内容 |
| `POST /api/preview-filled` | 预览填充后的文档 |

---

## Scope

- 模板内容 HTML 预览
- 占位符可视化高亮
- 填充内容面板
- 填充后文档预览
